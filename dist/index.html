<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="./style.css">
  <title>Koinos Contract</title>
</head>

<body>
  <div id="app">
    <header>
      <h1>Contract</h1>
      <input type="text" v-model="inputContractId" placeholder="Contract ID"/>
      <button @click="connectKondor()">Connect kondor</button>
    </header>
    <div class="card">
      <div v-for="method in contractMethods" :key="method.name">
        {{method.name}}
      </div>
    </div>
  </div>
  </body>
  <script src="js/kondor.min.js"></script>
  <script src="js/koinos.min.js"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script type="module">
    const { createApp } = Vue;
    let defaultKoinosProvider = "https://api.koinos.io";
    const mkwWalletConnectorUrl =
      "https://mykw.vercel.app/embed/wallet-connector";
    let mkw;
    
    createApp({
      data() {
        return {
          accounts: null,
          contract: null,
          contractMethods: [],
          inputContractId: "",
        };
      },

      watch: {
        inputContractId: function (val) {
          this.loadContract(val);
        },
      },

      mounted() {
        // mkw = new MyKoinosWallet(mkwWalletConnectorUrl);
        // mkw.connect();
      },

      methods: {
        async connectKondor() {
          console.log("Connecting kondor...");
          this.accounts = await kondor.getAccounts();
          console.log("Kondor connected");
        },

        async loadContract(id) {
          //if (!this.accounts) await this.connectKondor();
          const provider = new Provider(["https://api.koinos.io"]);
          //const userAddress = this.accounts[0].address;

          this.contract = new Contract({
            id,
            provider,
            //signer: kondor.getSigner(userAddress),
          });
          await this.contract.fetchAbi();

          this.contractMethods = Object.keys(this.contract.abi.methods).map(m => {
            return {
              name: m,
              readOnly: this.contract.abi.methods[m].read_only,
            }
          });
        },
      },
    }).mount("#app");
  </script>
</html>